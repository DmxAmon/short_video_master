import{_ as A,r as v,C as f,D as q,G as F,H as j,I as G,x as H,E as K,J as z,i as P,o as g,k as h,m as s,w as n,l as u,p as m,t as S,q as C,F as Q,s as R,K as W,L as X,n as p,N as Y}from"./index.7274972e.js";/* empty css                */const Z={class:"membership-debug"},ee={class:"debug-section"},le={key:0},te={key:1},se={class:"diagnosis"},oe={__name:"MembershipDebugView",props:{user:{type:Object,required:!0}},emits:["refresh-user-info"],setup(E,{emit:N}){const o=E,U=N,L=v(!1),I=v(!1),k=v(!1),r=v(null),d=v(null),_=f(()=>({memberLevel:o.user.memberLevel,memberExpireTime:o.user.memberExpireTime?new Date(o.user.memberExpireTime).toLocaleString():"\u65E0",id:o.user.id,username:o.user.username})),x=f(()=>{const l=localStorage.getItem("user_info");return l?JSON.stringify(JSON.parse(l),null,2):"\u65E0\u6570\u636E"}),V=f(()=>r.value?JSON.stringify(r.value,null,2):""),w=f(()=>d.value?JSON.stringify(d.value,null,2):""),$=f(()=>{var e,c,b,i;const l=[];try{const t=JSON.parse(localStorage.getItem("user_info")||"{}");t.memberLevel&&t.memberLevel!==o.user.memberLevel&&l.push({type:"data_mismatch",title:"localStorage\u4E0E\u524D\u7AEF\u6570\u636E\u4E0D\u4E00\u81F4",description:`localStorage: ${t.memberLevel}, \u524D\u7AEF: ${o.user.memberLevel}`,level:"warning"}),t.membership&&t.membership.levelCode!==o.user.memberLevel&&l.push({type:"membership_mismatch",title:"membership.levelCode\u4E0E\u5F53\u524D\u7B49\u7EA7\u4E0D\u4E00\u81F4",description:`membership.levelCode: ${t.membership.levelCode}, \u5F53\u524D: ${o.user.memberLevel}`,level:"error"})}catch(t){l.push({type:"parse_error",title:"localStorage\u6570\u636E\u89E3\u6790\u5931\u8D25",description:t.message,level:"error"})}if(r.value){const t=((c=(e=r.value.data)==null?void 0:e.membership)==null?void 0:c.levelCode)||((b=r.value.data)==null?void 0:b.memberLevel);t&&t!==o.user.memberLevel&&l.push({type:"backend_mismatch",title:"\u540E\u7AEF\u6570\u636E\u4E0E\u524D\u7AEF\u4E0D\u4E00\u81F4",description:`\u540E\u7AEF: ${t}, \u524D\u7AEF: ${o.user.memberLevel}`,level:"error"})}if(d.value){const t=(i=d.value.data)==null?void 0:i.levelCode;t&&t!==o.user.memberLevel&&l.push({type:"status_mismatch",title:"\u4F1A\u5458\u72B6\u6001\u63A5\u53E3\u6570\u636E\u4E0E\u524D\u7AEF\u4E0D\u4E00\u81F4",description:`\u72B6\u6001\u63A5\u53E3: ${t}, \u524D\u7AEF: ${o.user.memberLevel}`,level:"error"})}return l.length===0&&l.push({type:"no_issues",title:"\u6682\u672A\u53D1\u73B0\u660E\u663E\u95EE\u9898",description:"\u6240\u6709\u68C0\u67E5\u9879\u76EE\u90FD\u901A\u8FC7\uFF0C\u53EF\u80FD\u9700\u8981\u68C0\u67E5\u540E\u7AEF\u6570\u636E\u5E93\u6216\u5176\u4ED6\u73AF\u8282",level:"success"}),l}),D=async()=>{L.value=!0;try{console.log("\u8C03\u8BD5\uFF1A\u83B7\u53D6 /plugin-auth/user \u6570\u636E");const l=await X("/plugin-auth/user");r.value=l,console.log("\u540E\u7AEF\u7528\u6237\u4FE1\u606F:",l),p.success("\u83B7\u53D6\u7528\u6237\u4FE1\u606F\u6210\u529F")}catch(l){console.error("\u83B7\u53D6\u7528\u6237\u4FE1\u606F\u5931\u8D25:",l),p.error("\u83B7\u53D6\u7528\u6237\u4FE1\u606F\u5931\u8D25: "+l.message)}finally{L.value=!1}},J=async()=>{I.value=!0;try{console.log("\u8C03\u8BD5\uFF1A\u83B7\u53D6 /membership/status \u6570\u636E");const l=await Y();d.value=l,console.log("\u4F1A\u5458\u72B6\u6001\u4FE1\u606F:",l),p.success("\u83B7\u53D6\u4F1A\u5458\u72B6\u6001\u6210\u529F")}catch(l){console.error("\u83B7\u53D6\u4F1A\u5458\u72B6\u6001\u5931\u8D25:",l),p.error("\u83B7\u53D6\u4F1A\u5458\u72B6\u6001\u5931\u8D25: "+l.message)}finally{I.value=!1}},M=async()=>{k.value=!0;try{await D(),r.value&&r.value.code===0&&(localStorage.setItem("user_info",JSON.stringify(r.value.data)),console.log("\u5DF2\u66F4\u65B0localStorage\u7528\u6237\u4FE1\u606F"),U("refresh-user-info"),p.success("\u7528\u6237\u6570\u636E\u5DF2\u5237\u65B0"))}catch(l){p.error("\u5237\u65B0\u7528\u6237\u6570\u636E\u5931\u8D25: "+l.message)}finally{k.value=!1}},O=()=>{localStorage.removeItem("user_info"),localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),p.success("\u672C\u5730\u7F13\u5B58\u5DF2\u6E05\u7A7A\uFF0C\u8BF7\u91CD\u65B0\u5237\u65B0\u9875\u9762")};return q(()=>{console.log("\u4F1A\u5458\u8C03\u8BD5\u9875\u9762\u52A0\u8F7D\uFF0C\u5F53\u524D\u7528\u6237\u4FE1\u606F:",o.user)}),(l,e)=>{const c=F,b=j,i=G,t=H,y=K,B=z,T=P;return g(),h("div",Z,[s(T,{header:"\u4F1A\u5458\u72B6\u6001\u8C03\u8BD5\u4FE1\u606F"},{default:n(()=>[u("div",ee,[e[7]||(e[7]=u("h3",null,"1. \u524D\u7AEF\u5B58\u50A8\u7684\u7528\u6237\u4FE1\u606F",-1)),s(b,{border:"",column:2},{default:n(()=>[s(c,{label:"\u4F1A\u5458\u7B49\u7EA7"},{default:n(()=>[m(S(_.value.memberLevel),1)]),_:1}),s(c,{label:"\u4F1A\u5458\u8FC7\u671F\u65F6\u95F4"},{default:n(()=>[m(S(_.value.memberExpireTime),1)]),_:1}),s(c,{label:"\u7528\u6237ID"},{default:n(()=>[m(S(_.value.id),1)]),_:1}),s(c,{label:"\u7528\u6237\u540D"},{default:n(()=>[m(S(_.value.username),1)]),_:1})]),_:1}),s(i),e[8]||(e[8]=u("h3",null,"2. localStorage\u539F\u59CB\u6570\u636E",-1)),s(t,{modelValue:x.value,"onUpdate:modelValue":e[0]||(e[0]=a=>x.value=a),type:"textarea",rows:"8",readonly:"",style:{"font-family":"monospace"}},null,8,["modelValue"]),s(i),e[9]||(e[9]=u("h3",null,"3. \u540E\u7AEF /plugin-auth/user \u63A5\u53E3\u6570\u636E",-1)),s(y,{onClick:D,loading:L.value,type:"primary"},{default:n(()=>e[3]||(e[3]=[m(" \u91CD\u65B0\u83B7\u53D6\u7528\u6237\u4FE1\u606F ")])),_:1,__:[3]},8,["loading"]),r.value?(g(),h("div",le,[s(t,{modelValue:V.value,"onUpdate:modelValue":e[1]||(e[1]=a=>V.value=a),type:"textarea",rows:"8",readonly:"",style:{"font-family":"monospace","margin-top":"10px"}},null,8,["modelValue"])])):C("",!0),s(i),e[10]||(e[10]=u("h3",null,"4. \u4F1A\u5458\u72B6\u6001\u63A5\u53E3 /membership/status",-1)),s(y,{onClick:J,loading:I.value,type:"warning"},{default:n(()=>e[4]||(e[4]=[m(" \u83B7\u53D6\u4F1A\u5458\u72B6\u6001 ")])),_:1,__:[4]},8,["loading"]),d.value?(g(),h("div",te,[s(t,{modelValue:w.value,"onUpdate:modelValue":e[2]||(e[2]=a=>w.value=a),type:"textarea",rows:"8",readonly:"",style:{"font-family":"monospace","margin-top":"10px"}},null,8,["modelValue"])])):C("",!0),s(i),e[11]||(e[11]=u("h3",null,"5. \u95EE\u9898\u8BCA\u65AD",-1)),u("div",se,[(g(!0),h(Q,null,R($.value,a=>(g(),W(B,{key:a.type,title:a.title,description:a.description,type:a.level,"show-icon":"",style:{"margin-bottom":"10px"}},null,8,["title","description","type"]))),128))]),s(i),e[12]||(e[12]=u("h3",null,"6. \u4FEE\u590D\u64CD\u4F5C",-1)),s(y,{onClick:M,type:"success",loading:k.value},{default:n(()=>e[5]||(e[5]=[m(" \u5F3A\u5236\u5237\u65B0\u7528\u6237\u6570\u636E ")])),_:1,__:[5]},8,["loading"]),s(y,{onClick:O,type:"danger"},{default:n(()=>e[6]||(e[6]=[m(" \u6E05\u7A7A\u672C\u5730\u7F13\u5B58 ")])),_:1,__:[6]})])]),_:1})])}}},ne=A(oe,[["__scopeId","data-v-9a5af0ac"]]);export{ne as default};
